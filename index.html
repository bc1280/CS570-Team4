<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fitchburg Library Room Reservation</title>
    <link href="css/main.css" rel="stylesheet" />
    <link href="css/jquery-ui.min.css" rel="stylesheet" />
    <link href="css/jquery-ui.theme.min.css" rel="stylesheet" />
    <script src="scripts/jquery.js"></script>
    <script src="scripts/jquery-ui.min.js"></script>
    <script type="text/javascript">
        $(function () {
            InitPage();
 
        });

        function InitPage(){
            //$("#main").html(hbMan.getTemplate("hb_systemAlert")({ title: "brrr" }));
            $( ".selectable" ).selectable({
              filter: "li:not(.unselectable)",
              cancel: "li.unselectable",
              start: function(){
                $(".ui-selected").removeClass("ui-selected");
              },
              stop: function(){
                SelectTime();
                prev = -1;
              },
              selecting: function(e, ui) {
                var curr = $(ui.selecting.tagName, e.target).index(ui.selecting);
                if(prev > -1 && Math.abs(curr - prev) > 1){
                      e.stopImmediatePropagation();
                      e.stopPropagation();
                      e.preventDefault();
                      $(ui.selecting).removeClass("ui-selecting");
                      return false;
                } else {
                    prev = curr;
                }
              }
            });
            $( "#datepicker" ).datepicker({
              changeMonth: true,
              changeYear: true,
              minDate: 0,
              onSelect: function(dateText){
                SelectDate(dateText);
              }
            });
            $(".button").button().hide().on("click",function(){
              $("#main").hide();
              $("#confirmation").show();
            });
        }

        var prev = -1;
        var availableTimes = [];
        var daysOfWeek = ["sundays","mondays","tuesdays","wednesdays","thursdays","fridays","saturdays"];

        function SelectDate(dateText){
          $("#rooms").show();
          $("#key").show();
          var sDate = new Date(dateText);
          var day = sDate.getDay();
          var dayMod = day%2;
          var lists = [$("#timeList"),$("#room1"),$("#room2")];
          availableTimes = [];
          var openTime = "";
          var closingTime = "";

          $("#rooms ul").html("");
          $("#selectedDate").html("Availability for: " + dateText);
          $("#continue").hide();

          var x =0;
          times.forEach(function(t){
            if(t.days.indexOf(day) > -1){
              var c = (t.beforeOpen.indexOf(day) > -1 ? "beforeOpen" : (t.afterClose.indexOf(day) > -1 ? "afterClose" : ""));

              if(!openTime.length && !c.length)
                openTime = t.startTime;
              else if(!c.length)
                closingTime = t.startTime;

              var tm = t.startTime + " - " + t.endTime;
              lists[0].append(GetLI(tm, c));
              lists[1].append(GetLI(t.cr[dayMod], c, "cr_" + x));
              lists[2].append(GetLI(t.mr[dayMod], c, "mr_" + x));
              availableTimes.push(t);
              x++;
            }
          });

          $("#key div.afterClose").html("Reservations can not start after the library closes at " + closingTime + " on " + daysOfWeek[day]);
          $("#key div.beforeOpen").html("For reservations starting before the library opens at " + openTime + ", you must call in advance to gain access to the building");


        }

        function SelectTime(){
          var selectedTimes = [];
          var selectedType = "";
          var cOpen = 0;
          var cClosed = 0;
          var cEarly = 0;
          $(".ui-selected").each(function(){
            var tmp = this.id.split("_");
            selectedType = tmp[0];
            selectedTimes.push(availableTimes[tmp[1]]);
            if($(this).hasClass("afterClose"))
              cClosed++;
            else{
              cOpen++;
              if($(this).hasClass("beforeOpen"))
                cEarly++;
            }
          });

          $(".emphasize").removeClass("emphasize");
          if(cClosed > 0 && cOpen == 0){
            $(".ui-selected").removeClass("ui-selected");
            $("#key div.afterClose").effect("shake",1000).addClass("emphasize");
            $("#continue").hide();
          }else{
            $("#continue").show();
            if(cEarly > 0)
              $("#key div.beforeOpen").effect("pulsate",1000).addClass("emphasize");
          }
        }

        function GetLI(label, c, i){
          var cl = (label.toLowerCase() !== "open" ? "unselectable " : "") + c;
          return "<li id='" + i + "' class='" + cl + "'>" + label +"</li>";
        }
    </script>
    
</head>
<body>
<h1>Fitchburg Library</h1>
<div id="main" class="clear-fix">
  <div style="float: left; width: 305px; padding: 5px;">
     <div id="datepicker"></div>
     <div id="key">
     <div class="beforeOpen"></div>
     <div class="afterClose"></div>
     </div>
   </div>
   <div style="float: left; min-width: 600px; width: 65%; padding: 5px;">
     <h2 id="selectedDate">Please choose a date</h2>
     <div id="rooms" class="clear-fix hidden">
       <div>&nbsp;<br /><strong>Times:</strong>
         <ul id="timeList">
        </ul>
        </div>
        <div><strong>Conference Room</strong> <br />capacity: 4 - 20

        <ul id="room1" class="selectable">
        </ul>
        </div>
        <div><strong>Meeting Room</strong> <br />capacity: 4 - 145
        <ul id="room2" class="selectable">
        </ul>
        </div>
      </div>
        <button id="continue" class="button">Continue</button>
      
     </div>  

</div>
<div id="confirmation" class="hidden">
<h1>This is where you would confirm the reservation</h1>
<a href="index.html">return to beginning</a>
</div>
    <script  type="text/javascript">
    var times = [
      {days:[1,2,3,4,5,6],startTime:"7:00 AM",endTime:"7:30 AM",beforeOpen:[0,1,2,3,4,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[1,2,3,4,5,6],startTime:"7:30 AM",endTime:"8:00 AM",beforeOpen:[0,1,2,3,4,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[1,2,3,4,5,6],startTime:"8:00 AM",endTime:"8:30 AM",beforeOpen:[0,1,2,3,4,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[1,2,3,4,5,6],startTime:"8:30 AM",endTime:"9:00 AM",beforeOpen:[0,1,2,3,4,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"9:00 AM",endTime:"9:30 AM",beforeOpen:[0,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"9:30 AM",endTime:"10:00 AM",beforeOpen:[0,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"10:00 AM",endTime:"10:30 AM",beforeOpen:[0],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"10:30 AM",endTime:"11:00 AM",beforeOpen:[0],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"11:00 AM",endTime:"11:30 AM",beforeOpen:[0],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"11:30 AM",endTime:"12:00 PM",beforeOpen:[0],afterClose:[],cr:["unavailable","open"],mr:["open","unavailable"]},
      {days:[0,1,2,3,4,5,6],startTime:"12:00 PM",endTime:"12:30 PM",beforeOpen:[0],afterClose:[],cr:["reserved","open"],mr:["open","reserved"]},
      {days:[0,1,2,3,4,5,6],startTime:"12:30 PM",endTime:"1:00 PM",beforeOpen:[0],afterClose:[],cr:["reserved","open"],mr:["open","reserved"]},
      {days:[0,1,2,3,4,5,6],startTime:"1:00 PM",endTime:"1:30 PM",beforeOpen:[],afterClose:[],cr:["reserved","open"],mr:["open","reserved"]},
      {days:[0,1,2,3,4,5,6],startTime:"1:30 PM",endTime:"2:00 PM",beforeOpen:[],afterClose:[],cr:["reserved","open"],mr:["open","reserved"]},
      {days:[0,1,2,3,4,5,6],startTime:"2:00 PM",endTime:"2:30 PM",beforeOpen:[],afterClose:[],cr:["unavailable","open"],mr:["open","unavailable"]},
      {days:[0,1,2,3,4,5,6],startTime:"2:30 PM",endTime:"3:00 PM",beforeOpen:[],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"3:00 PM",endTime:"3:30 PM",beforeOpen:[],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"3:30 PM",endTime:"4:00 PM",beforeOpen:[],afterClose:[],cr:["open","unavailable"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"4:00 PM",endTime:"4:30 PM",beforeOpen:[],afterClose:[],cr:["unavailable","reserved"],mr:["unavailable","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"4:30 PM",endTime:"5:00 PM",beforeOpen:[],afterClose:[],cr:["reserved","reserved"],mr:["reserved","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"5:00 PM",endTime:"5:30 PM",beforeOpen:[],afterClose:[0],cr:["reserved","reserved"],mr:["reserved","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"5:30 PM",endTime:"6:00 PM",beforeOpen:[],afterClose:[0],cr:["unavailable","reserved"],mr:["reserved","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"6:00 PM",endTime:"6:30 PM",beforeOpen:[],afterClose:[0,5,6],cr:["reserved","reserved"],mr:["reserved","unavailable"]},
      {days:[0,1,2,3,4,5,6],startTime:"6:30 PM",endTime:"7:00 PM",beforeOpen:[],afterClose:[0,5,6],cr:["reserved","unavailable"],mr:["reserved","reserved"]},
      {days:[1,2,3,4,5,6],startTime:"7:00 PM",endTime:"7:30 PM",beforeOpen:[],afterClose:[0,5,6],cr:["reserved","open"],mr:["reserved","reserved"]},
      {days:[1,2,3,4,5,6],startTime:"7:30 PM",endTime:"8:00 PM",beforeOpen:[],afterClose:[0,5,6],cr:["unavailable","open"],mr:["reserved","reserved"]},
      {days:[1,2,3,4],startTime:"8:00 PM",endTime:"8:30 PM",beforeOpen:[],afterClose:[0,5,6],cr:["open","open"],mr:["reserved","reserved"]},
      {days:[1,2,3,4],startTime:"8:30 PM",endTime:"9:00 PM",beforeOpen:[],afterClose:[0,5,6],cr:["open","open"],mr:["reserved","unavailable"]},
      {days:[1,2,3,4],startTime:"9:00 PM",endTime:"9:30 PM",beforeOpen:[],afterClose:[0,1,2,3,4,5,6],cr:["open","open"],mr:["reserved","open"]},
      {days:[1,2,3,4],startTime:"9:30 PM",endTime:"10:00 PM",beforeOpen:[],afterClose:[0,1,2,3,4,5,6],cr:["open","open"],mr:["unavailable","open"]},
      {days:[1,2,3,4],startTime:"10:00 PM",endTime:"10:30 PM",beforeOpen:[],afterClose:[0,1,2,3,4,5,6],cr:["open","open"],mr:["open","open"]},
      {days:[1,2,3,4],startTime:"10:30 PM",endTime:"11:00 PM",beforeOpen:[],afterClose:[0,1,2,3,4,5,6],cr:["open","open"],mr:["open","open"]}];
    </script>
</body>
</html>