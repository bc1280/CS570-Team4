<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fitchburg Library Room Reservation</title>
    <link href="css/main.css" rel="stylesheet" />
    <link href="css/jquery-ui.min.css" rel="stylesheet" />
    <link href="css/jquery-ui.theme.min.css" rel="stylesheet" />
    <script src="scripts/jquery.js"></script>
    <script src="scripts/jquery-ui.min.js"></script>
    <script type="text/javascript">
        $(function () {
            InitPage();
        });

        function InitPage(){
            $("#startDemo").on("click",function(){
              $("#intro").remove();
              $("#main").show();
            });

            $("#dialog").dialog({
              autoOpen: false,
              height: 430,
              width: 410,
              buttons: {
                Close: function() {
                  $(this).dialog( "close" );
                }
              },
              close: function() {
                $(this).find("div.f8").hide();
              }

            });
            $( ".selectable" ).selectable({
              filter: "li:not(.unselectable)",
              cancel: "li.unselectable",
              start: function(){
                $(".ui-selected").removeClass("ui-selected");
              },
              stop: function(){
                SelectTime();
                prev = -1;
              },
              selecting: function(e, ui) {
                var curr = $(ui.selecting.tagName, e.target).index(ui.selecting);
                if(prev > -1 && Math.abs(curr - prev) > 1){
                      e.stopImmediatePropagation();
                      e.stopPropagation();
                      e.preventDefault();
                      $(ui.selecting).removeClass("ui-selecting");
                      return false;
                } else {
                    prev = curr;
                }
              }
            });
            $( "#datepicker" ).datepicker({
              changeMonth: true,
              changeYear: true,
              minDate: 0,
              onSelect: function(dateText){
                SelectDate(dateText);
              }
            });
            $(".button").button().hide().on("click",function(){
              $("#main").hide();
              $("#confirmation").show();
            });

            $("#rooms .room").on("click", "span.info",function(){
              var obj = $("#dialog");
              var dID = "#d" + this.id;
              if(obj.dialog("isOpen")){
                if($(dID).filter(":visible").length)
                  obj.dialog("close");
                else{
                  obj.find("div.f8").hide();
                  $(dID).show();
                }    
              }else{
                obj.dialog("open");
                $(dID).show();
              }
            });
        }

        var prev = -1;
        var availableTimes = [];
        var daysOfWeek = ["Sundays","Mondays","Tuesdays","Wednesdays","Thursdays","Fridays","Saturdays"];

        function GetLI(label, c, thisWeek, i){
          var props = (typeof(i) != "undefined" ? ("id='" + i + "'") : "");
          var cl = "unselectable ";
          if(label.toLowerCase() === "open"){
            if(thisWeek){
              props += " style='box-shadow: unset;'";
              label = "please call to reserve";
            }
            else
              cl = "";
          }
          
          
          return "<li " + props + " class='" + cl + c + "'>" + label +"</li>";
        }

        function SelectDate(dateText){
          $("#rooms").show();
          $("#key").show();
          var sDate = new Date(dateText);
          var dNow = new Date();
          dNow.setDate(dNow.getDate() + 7);
          var thisWeek = (sDate < dNow);
          var day = sDate.getDay();
          var dayMod = day%2;
          var lists = [$("#timeList"),$("#room1"),$("#room2")];
          availableTimes = [];
          var openTime = "";
          var closingTime = "";

          $("#rooms ul").html("");
          $("#selectedDate").html("Availability for: " + dateText);
          $("#selectedSlot").html("");
          $("div.selected").removeClass("selected");
          $("#continue").hide();

          var x =0;
          times.forEach(function(t){
            if(t.days.indexOf(day) > -1){
              var c = (t.beforeOpen.indexOf(day) > -1 ? "beforeOpen" : (t.afterClose.indexOf(day) > -1 ? "afterClose" : ""));

              if(!openTime.length && !c.length)
                openTime = t.startTime;
              else if(!c.length)
                closingTime = t.startTime;

              var tm = t.startTime + " - " + t.endTime;
              lists[0].append(GetLI(tm, c));
              lists[1].append(GetLI(t.cr[dayMod], c, thisWeek, "cr_" + x));
              lists[2].append(GetLI(t.mr[dayMod], c, thisWeek, "mr_" + x));
              availableTimes.push(t);
              x++;
            }
          });

          $("#key div.afterClose").html("Reservations can not start after the library closes at " + closingTime + " on " + daysOfWeek[day]);
          $("#key div.beforeOpen").html("For reservations starting before the library opens at " + openTime + ", you must call in advance to gain access to the building");
          if(thisWeek)
            $("#note").show();
          else
            $("#note").hide();

        }

        function SelectTime(){
          var selectedTimes = [];
          var selectedType = "";
          var cOpen = 0;
          var cClosed = 0;
          var cEarly = 0;
          $(".ui-selected").each(function(){
            var tmp = this.id.split("_");
            selectedType = tmp[0];
            selectedTimes.push(availableTimes[tmp[1]]);
            if($(this).hasClass("afterClose"))
              cClosed++;
            else{
              cOpen++;
              if($(this).hasClass("beforeOpen"))
                cEarly++;
            }
          });

          $("#selectedSlot").html("");
          $(".emphasize").removeClass("emphasize");
          $("div.selected").removeClass("selected");
          if(cClosed > 0 && cOpen == 0){
            $(".ui-selected").removeClass("ui-selected");
            $("#key div.afterClose").effect("shake",1000).addClass("emphasize");
            $("#continue").hide();
          }else{
            var i = selectedTimes.length - 1;
            var sTime = "Selected time slot: " + selectedTimes[0].startTime + " - " + selectedTimes[i].endTime;
            $("#selectedSlot").html(sTime);
            $("#continue").show();
            $("#rooms > div:has(li.ui-selected)").find("div.room").addClass("selected");
            if(cEarly > 0)
              $("#key div.beforeOpen").effect("pulsate",1000).addClass("emphasize");
          }
        }
    </script>
    
</head>
<body>
<div id="intro">
<div id="startDemo"><p>Reserve a Room</p></div>
</div>
<div id="main" class="hidden">
  <h1 class="ui-widget-header">Fitchburg Library Room Reservations</h1>
  <div class="clear-fix">
    <div style="float: left; width: 305px; padding: 5px;">
       <div id="datepicker"></div>
       <div class="p5 bg-lt-blue f8">*** Reservations less than a week in advance must be made directly with the library.  Please call <strong>555-1234</strong> with any questions or issues</div>
       <div id="key">
         <div class="beforeOpen"></div>
         <div class="afterClose"></div>
       </div>
   </div>
     <div style="float: left; min-width: 600px; width: 65%; padding: 5px;">
       <span id="selectedDate">Please choose a date</span> <strong id="selectedSlot" style="margin-left: 20px;"></strong>
       <div id="note" class="ui-state-highlight p5"><p>NOTE: When requesting a room less than a week in advance, you must call the library (555-1234) to make the reservation</p></div>
       <div id="rooms" class="clear-fix hidden">
         <div><div>&nbsp;<br /><strong>Times:</strong></div>
           <ul id="timeList">
          </ul>
          </div>
          <div><div class="room"><strong>Conference Room</strong> <span id="cri" class="info ui-icon ui-corner-all"></span><br />capacity: 4 - 20</div>
          <ul id="room1" class="selectable">
          </ul>
          </div>
          <div><div class="room"><strong>Meeting Room</strong> <span id="mri" class="info ui-icon ui-corner-all"></span><br />capacity: 4 - 145</div>
          <ul id="room2" class="selectable">
          </ul>
          </div>
        </div>
          <button id="continue" class="button">Continue</button>
        <div id="dialog" title="Room Details">
          <div id="dmri" class="hidden f8"><strong>Meeting Room </strong><br />Minimum Capacity: 4   Maximum Capacity: 145<br />
            Standard Fixtures:<ul class="nUL">
            <li>Blu-ray Player</li>
            <li>
            Hitachi WXGA Projector</li>
            <li>
            Kitchenette w/ refrigerator, sink, and microwave.</li>
            <li>
            Podium</li>
            <li>
            Shure Cardoid Gooseneck Microphone</li>
            <li>
            Stackable Chairs</li>
            <li>
            White board</li>
            <li>
            Wireless Microphone System w/Lavalier Mic</li></ul>
            Standard Equipment:
            Assisted Listening Devices - Request at Ref. Desk
          </div>
          <div id="dcri" class="hidden f8"><strong>Conference Room</strong><br />Minimum Capacity: 4   Maximum Capacity: 20<br />
            Standard Fixtures:
            <ul class="nUL">
            <li>55" LED Monitor</li>
            <li>Conference Chairs</li>
            <li>Large Conference Table</li>
            <li>Side chairs</li>
            <li>White board</li></ul>
            Standard Equipment:
            Assisted Listening Devices - Request at Ref. Desk
          </div>
        </div>
     </div>  
  </div>
</div>
<div id="confirmation" class="hidden">
<h1>This is where you would confirm the reservation</h1>
<a href="index.html">return to beginning</a>
</div>
    <script  type="text/javascript">
    var times = [
      {days:[1,2,3,4,5,6],startTime:"7:00 AM",endTime:"7:30 AM",beforeOpen:[0,1,2,3,4,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[1,2,3,4,5,6],startTime:"7:30 AM",endTime:"8:00 AM",beforeOpen:[0,1,2,3,4,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[1,2,3,4,5,6],startTime:"8:00 AM",endTime:"8:30 AM",beforeOpen:[0,1,2,3,4,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[1,2,3,4,5,6],startTime:"8:30 AM",endTime:"9:00 AM",beforeOpen:[0,1,2,3,4,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"9:00 AM",endTime:"9:30 AM",beforeOpen:[0,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"9:30 AM",endTime:"10:00 AM",beforeOpen:[0,5,6],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"10:00 AM",endTime:"10:30 AM",beforeOpen:[0],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"10:30 AM",endTime:"11:00 AM",beforeOpen:[0],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"11:00 AM",endTime:"11:30 AM",beforeOpen:[0],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"11:30 AM",endTime:"12:00 PM",beforeOpen:[0],afterClose:[],cr:["unavailable","open"],mr:["open","unavailable"]},
      {days:[0,1,2,3,4,5,6],startTime:"12:00 PM",endTime:"12:30 PM",beforeOpen:[0],afterClose:[],cr:["reserved","open"],mr:["open","reserved"]},
      {days:[0,1,2,3,4,5,6],startTime:"12:30 PM",endTime:"1:00 PM",beforeOpen:[0],afterClose:[],cr:["reserved","open"],mr:["open","reserved"]},
      {days:[0,1,2,3,4,5,6],startTime:"1:00 PM",endTime:"1:30 PM",beforeOpen:[],afterClose:[],cr:["reserved","open"],mr:["open","reserved"]},
      {days:[0,1,2,3,4,5,6],startTime:"1:30 PM",endTime:"2:00 PM",beforeOpen:[],afterClose:[],cr:["reserved","open"],mr:["open","reserved"]},
      {days:[0,1,2,3,4,5,6],startTime:"2:00 PM",endTime:"2:30 PM",beforeOpen:[],afterClose:[],cr:["unavailable","open"],mr:["open","unavailable"]},
      {days:[0,1,2,3,4,5,6],startTime:"2:30 PM",endTime:"3:00 PM",beforeOpen:[],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"3:00 PM",endTime:"3:30 PM",beforeOpen:[],afterClose:[],cr:["open","open"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"3:30 PM",endTime:"4:00 PM",beforeOpen:[],afterClose:[],cr:["open","unavailable"],mr:["open","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"4:00 PM",endTime:"4:30 PM",beforeOpen:[],afterClose:[],cr:["unavailable","reserved"],mr:["unavailable","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"4:30 PM",endTime:"5:00 PM",beforeOpen:[],afterClose:[],cr:["reserved","reserved"],mr:["reserved","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"5:00 PM",endTime:"5:30 PM",beforeOpen:[],afterClose:[0],cr:["reserved","reserved"],mr:["reserved","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"5:30 PM",endTime:"6:00 PM",beforeOpen:[],afterClose:[0],cr:["unavailable","reserved"],mr:["reserved","open"]},
      {days:[0,1,2,3,4,5,6],startTime:"6:00 PM",endTime:"6:30 PM",beforeOpen:[],afterClose:[0,5,6],cr:["reserved","reserved"],mr:["reserved","unavailable"]},
      {days:[0,1,2,3,4,5,6],startTime:"6:30 PM",endTime:"7:00 PM",beforeOpen:[],afterClose:[0,5,6],cr:["reserved","unavailable"],mr:["reserved","reserved"]},
      {days:[1,2,3,4,5,6],startTime:"7:00 PM",endTime:"7:30 PM",beforeOpen:[],afterClose:[0,5,6],cr:["reserved","open"],mr:["reserved","reserved"]},
      {days:[1,2,3,4,5,6],startTime:"7:30 PM",endTime:"8:00 PM",beforeOpen:[],afterClose:[0,5,6],cr:["unavailable","open"],mr:["reserved","reserved"]},
      {days:[1,2,3,4],startTime:"8:00 PM",endTime:"8:30 PM",beforeOpen:[],afterClose:[0,5,6],cr:["open","open"],mr:["reserved","reserved"]},
      {days:[1,2,3,4],startTime:"8:30 PM",endTime:"9:00 PM",beforeOpen:[],afterClose:[0,5,6],cr:["open","open"],mr:["reserved","unavailable"]},
      {days:[1,2,3,4],startTime:"9:00 PM",endTime:"9:30 PM",beforeOpen:[],afterClose:[0,1,2,3,4,5,6],cr:["open","open"],mr:["reserved","open"]},
      {days:[1,2,3,4],startTime:"9:30 PM",endTime:"10:00 PM",beforeOpen:[],afterClose:[0,1,2,3,4,5,6],cr:["open","open"],mr:["unavailable","open"]},
      {days:[1,2,3,4],startTime:"10:00 PM",endTime:"10:30 PM",beforeOpen:[],afterClose:[0,1,2,3,4,5,6],cr:["open","open"],mr:["open","open"]},
      {days:[1,2,3,4],startTime:"10:30 PM",endTime:"11:00 PM",beforeOpen:[],afterClose:[0,1,2,3,4,5,6],cr:["open","open"],mr:["open","open"]}];
    </script>
</body>
</html>